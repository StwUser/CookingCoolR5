name: Integ
on:
  push:
    branches:
      - "main"
jobs:
  build: 
    runs-on: windows-latest
    steps:
      - name: Check out code ğŸ›ï¸
        uses: actions/checkout@v3

      - name: SetUp connection string ğŸ–ï¸
        uses: microsoft/variable-substitution@v1 
        with:
          files: './CookingCoolR5/appsettings.json'
        env:
          ConnectionString: ${{ secrets.connection_string }}        

      - name: Setup .NET 5 ğŸ•¸ï¸
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '5.0.x'

      - name: Restore ğŸ€
        run: dotnet restore
      - name: Build ğŸš€
        run: dotnet build -c Release --no-restore

      - name: List files in the repository ğŸ“‚
        run: |
          ls ${{ github.workspace.CookingCoolR5 }}        

      - name: Read file contents ğŸ‘“
        id: read_file
        uses: andstor/file-reader-action@v1
        with:
          path: "CookingCoolR5/appsettings.json"

      - name: File contents ğŸ˜
        run: echo "${ steps.read_file.outputs.contents }"        

      - name: Run tests ğŸ’š
        run: dotnet test -c Release --no-build        

      - name: Publish ğŸ‘²
        run: dotnet publish -c Release --output ./Pub

      - name: Sync files ğŸ“‚
        uses: SamKirkland/FTP-Deploy-Action@4.3.3
        with:
          server: CookingCoolR5.somee.com
          username: ${{ secrets.ftp_login }}
          password: ${{ secrets.ftp_password }}
          local-dir: ./Pub/
          server-dir: /www.CookingCoolR5.somee.com/ 
